<%= render :partial => "side_bar/category", :locals =>{:path=>"back"}%>

<div class="content-center">
	
	<div class="article-meta">
		<div class="info">
			<!-- show information -->
			<h2 class="title"><%= @article.title %></h2>

			<!-- poster -->
			<div class="user">
				<div><%= image_tag avatar_url(@article.user)%></div>
				<p class="poster"><%=@poster.username %></p>
			</div>

			<div class="status">
				<p>publised at <%= @article.updated_at %></p>
			</div>

			<div class="category">
				<p>category: <% @article.category_names %></p>
			</div>

		</div><!-- user-info -->

		<div class="edit-it">
			<!-- add or remove favroite -->
			<p>
				<% if current_user %>
					<% unless @favorite %>
					<%= button_to "Add to My favorite", add_favorite_article_path(@article), :class=>"btn btn-primary" %>
					<% else %>
					<%= button_to "Remove from My favorite", remove_favorite_article_path(@article), :class=>"btn btn-warning" %>
					<% end %>
				<% end %>
			</p>


			<!-- Edit and delete -->	
			<% if @article.user == current_user %>
			<p class="edit"><%= link_to "Edit",edit_article_path(@article),:class=>"btn btn-info"%></p>


				<% if current_user.role = "admin" %>
				<p class="article-show-info-delete"><%= link_to "Delete",article_path(@article), :method=>:delete, :class=>"btn btn-danger", :data=>{:confirm=>"Are you sure?"}%></p>
				<% end %>
			<% end %>
		</div><!-- edit-it -->
	</div><!-- article-meta -->


	<!-- show content -->
	<div class="single-article-content show-body">
		<p><%= simple_format(@article.content) %></p>
	</div>


	<!-- comments -->
	<div class="article-comments">
		<div class="title">
			<h4>Reply</h4>
			<%= content_tag(:div, "", :class=>"note") %>
		</div>
	
		<div class="post">
			<% if current_user %>
				<%= render :partial=>'comments/form' %>

			<% else %>
				<%= link_to "Sign-in to post your comment", user_session_path, :class=>"btn btn-primary" %>

			<% end %><!-- if current_user  -->

		</div><!-- post -->


		<table class="table">
			<tr class="table-head">
				<th>Poster</th>
				<th>Comment</th>
				<th>Post time</th>
				<th></th>
				<th></th>
			</tr>

		<% if @comments.count>0 %>
			<% @comments.each do |c| %>
			<tr class="comment-<%=c.id%>">
				<td> <% if c.user %> 
					<%= link_to c.user.username, user_path(c.user) %>
					<% end %>
				</td>
				<td> <%=c.content %> </td>
				<td> <%=c.updated_at %></td>

				<% if c.user == current_user %>
				<td> 
					<%= link_to "Edit", edit_article_comment_path(@article, c) , :remote=>true %>
				</td>
				<td> 
					<%= link_to "Delete", article_comment_path(@article, c), :method=>"delete", :remote=>true, :data=>{:confirm=>"Are you sure?"}, :id=>"comment-#{c.id}" %>
			  </td>
				<% end %>
			</tr>
			<% end %><!-- @comments -->

		<% else %>

			<tr class="no-reply">
				<td colspan="5">
					<p>No any reply</p>
				</td>
			</tr>

		<% end %><!-- if @comments.count>0 -->

		</table>

	</div><!-- article-comments -->


	<!-- FB like-->
	<div class="article-FB">
		<div class="fb-like" data-href="https://developers.facebook.com/docs/plugins/" data-width="100" data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>

		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v2.3";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
		</script>
	
	</div>

</div><!-- content-center -->


